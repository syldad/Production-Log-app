<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Log v16 (Multi-Page)</title>
    
    <!-- PWA / Full-Screen Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#F97316">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #FFF8F0; }
        .modal { transition: opacity 0.3s ease; }
        .table-cell { padding: 10px; border-bottom: 1px solid #F3E8DB; }
        html { overflow-y: scroll; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #FFF8F0; }
        ::-webkit-scrollbar-thumb { background: #FDBA74; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #FB923C; }
        :focus-visible { outline: 2px solid #F97316; outline-offset: 2px; border-radius: 4px; }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid transparent;
        }
        .btn-primary { background-color: #F97316; color: white; border-color: #F97316; }
        .btn-primary:hover { background-color: #EA580C; border-color: #EA580C; }
        .btn-secondary { background-color: #FED7AA; color: #9A3412; border-color: #FED7AA; }
        .btn-secondary:hover { background-color: #FDBA74; }
        .btn-danger { background-color: #DC2626; color: white; border-color: #DC2626; }
        .btn-danger:hover { background-color: #B91C1C; }
        .btn-outline { background-color: white; color: #EA580C; border-color: #FDBA74; }
        .btn-outline:hover { background-color: #FFF8F0; }
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #FDBA74;
            border-radius: 8px;
            background-color: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            border-color: #F97316;
            box-shadow: 0 0 0 2px #FDBA74;
            outline: none;
        }
        #custom-alert {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        #custom-alert.show {
            opacity: 1;
            pointer-events: auto;
        }
        .alert-box {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        #custom-alert.show .alert-box {
            transform: scale(1);
        }
        /* Page container style from winner.txt */
        .page-content {
            display: none; /* All pages hidden by default */
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Global App Container -->
    <div class="container mx-auto max-w-7xl p-4">

        <!-- Header - This is the main navigation -->
        <header class="mb-6">
            <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
                <h1 class="text-3xl font-bold text-orange-600">Production Log v16.0</h1>
                <div class="flex space-x-2">
                    <!-- These buttons now control the page navigation -->
                    <button id="btn-nav-home" class="btn btn-primary">Home</button>
                    <button id="btn-nav-summary" class="btn btn-secondary">Summary</button>
                </div>
            </div>
            
            <!-- Navigation Bar from winner.txt -->
            <nav class="mt-6 bg-white rounded-lg shadow-md overflow-x-auto">
                <div class="flex justify-center space-x-4 p-4">
                    <button id="btn-nav-slurry" class="btn btn-outline flex-1">Slurry Logs</button>
                    <button id="btn-nav-shito-batch" class="btn btn-outline flex-1">Shito Batch Logs</button>
                    <button id="btn-nav-shito-cooking" class="btn btn-outline flex-1">Shito Cooking Logs</button>
                </div>
            </nav>
        </header>

        <!-- Main Content Area -->
        <main>

            <!-- Page: Home (from winner.txt) -->
            <div id="page-home" class="page-content">
                <h2 class="text-2xl font-semibold mb-4 text-orange-600">Quick Actions</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <button id="btn-open-slurry" class="btn btn-primary h-24 text-xl">New Slurry Batch</button>
                    <button id="btn-open-shito-batch" class="btn btn-primary h-24 text-xl">New Shito Batch</button>
                    <button id="btn-open-shito-cooking" class="btn btn-primary h-24 text-xl">New Shito Cooking Log</button>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-2">Welcome!</h3>
                    <p class="text-gray-700">Select an action above to create a new log, or use the navigation bar to view existing logs.</p>
                </div>
            </div>

            <!-- Page: Slurry Logs -->
            <div id="page-slurry-log" class="page-content">
                <div id="tab-slurry" class="tab-content bg-white rounded-lg shadow-md overflow-x-auto">
                    <div class="p-4 flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0">
                        <h2 class="text-xl font-semibold">Slurry Batch Records</h2>
                        <input type="text" id="search-slurry" class="form-input w-full sm:w-1/3" placeholder="Search by batch, product...">
                    </div>
                    <table class="min-w-full">
                        <thead class="bg-orange-50">
                            <tr>
                                <th class="table-cell text-left font-medium">Date</th>
                                <th class="table-cell text-left font-medium">Batch #</th>
                                <th class="table-cell text-left font-medium">Product</th>
                                <th class="table-cell text-left font-medium">Line</th>
                                <th class="table-cell text-left font-medium">Brix</th>
                                <th class="table-cell text-left font-medium">Color L</th>
                                <th class="table-cell text-left font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="slurry-table-body" class="divide-y divide-orange-100">
                            <!-- Rows will be injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Page: Shito Batch Logs -->
            <div id="page-shito-batch-log" class="page-content">
                <div id="tab-shito-batch" class="tab-content bg-white rounded-lg shadow-md overflow-x-auto">
                    <div class="p-4 flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0">
                        <h2 class="text-xl font-semibold">Shito Batch Records</h2>
                        <input type="text" id="search-shito-batch" class="form-input w-full sm:w-1/3" placeholder="Search by batch, variant...">
                    </div>
                    <table class="min-w-full">
                        <thead class="bg-orange-50">
                            <tr>
                                <th class="table-cell text-left font-medium">Date</th>
                                <th class="table-cell text-left font-medium">Batch #</th>
                                <th class="table-cell text-left font-medium">Variant</th>
                                <th class="table-cell text-left font-medium">SKU</th>
                                <th class="table-cell text-left font-medium">Batch Size (T)</th>
                                <th class="table-cell text-left font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="shito-batch-table-body" class="divide-y divide-orange-100">
                            <!-- Rows will be injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Page: Shito Cooking Logs -->
            <div id="page-shito-cooking-log" class="page-content">
                <div id="tab-shito-cooking" class="tab-content bg-white rounded-lg shadow-md overflow-x-auto">
                    <div class="p-4 flex flex-col sm:flex-row justify-between items-center space-y-2 sm:space-y-0">
                        <h2 class="text-xl font-semibold">Shito Cooking Records</h2>
                        <input type="text" id="search-shito-cooking" class="form-input w-full sm:w-1/3" placeholder="Search by batch ID, cycle...">
                    </div>
                    <table class="min-w-full">
                        <thead class="bg-orange-50">
                            <tr>
                                <th class="table-cell text-left font-medium">Date</th>
                                <th class="table-cell text-left font-medium">Batch ID</th>
                                <th class="table-cell text-left font-medium">Variant</th>
                                <th class="table-cell text-left font-medium">SKU</th>
                                <th class="table-cell text-left font-medium">Cooking Cycle</th>
                                <th class="table-cell text-left font-medium">Cook Total</th>
                                <th class="table-cell text-left font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="shito-cooking-table-body" class="divide-y divide-orange-100">
                            <!-- Rows will be injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Page: Summary -->
            <div id="page-summary" class="page-content">
                <h2 class="text-2xl font-semibold mb-4 text-orange-600">Production Summary</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Slurry Batch Overview</h3>
                        <canvas id="slurry-chart"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Shito Production Overview</h3>
                        <canvas id="shito-chart"></canvas>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- ===== MODALS (from after.txt) ===== -->

    <!-- Modal: New Slurry Batch -->
    <div id="modal-slurry" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div id="modal-slurry-backdrop" class="fixed inset-0"></div>
        <div class="relative top-10 mx-auto p-6 border w-full max-w-3xl shadow-lg rounded-xl bg-white z-10">
            <h3 class="text-2xl font-semibold text-orange-600">New Slurry Batch Entry</h3>
            <form id="form-slurry" class="mt-4 space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Date</label>
                        <input type="date" name="date" class="form-input" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Shift</label>
                        <select name="shift" class="form-input" required>
                            <option value="">Select Shift</option>
                            <option value="SHa">SHa (Morning)</option>
                            <option value="SHb">SHb (Afternoon)</option>
                            <option value="SHc">SHc (Night)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Line</label>
                        <select name="line" class="form-input" required>
                            <option value="">Select Line</option>
                            <option value="Can Line">Can Line</option>
                            <option value="Sachet Line">Sachet Line</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Product Name</label>
                        <select name="productName" class="form-input" required>
                            <option value="">Select Product</option>
                            <option value="GINO">GINO</option>
                            <option value="POMO">POMO</option>
                            <option value="GINO / POMO">GINO / POMO</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Slurry Batch #</label>
                        <input type="text" name="slurryBatch" class="form-input" placeholder="e.g., C24001" required>
                    </div>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Mix Time (mins)</label>
                        <input type="number" step="0.1" name="mixTime" class="form-input" placeholder="e.g., 15">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Brix</label>
                        <input type="number" step="0.01" name="brix" class="form-input" placeholder="e.g., 28.5" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Color (L)</label>
                        <input type="number" step="0.01" name="colorL" class="form-input" placeholder="e.g., 23.0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Color (a/b)</label>
                        <input type="number" step="0.01" name="colorAB" class="form-input" placeholder="e.g., 2.1">
                    </div>
                </div>
                <fieldset class="border border-orange-200 p-4 rounded-lg">
                    <legend class="text-lg font-medium text-orange-600 px-2">Ingredients</legend>
                    <div id="slurry-ingredients-list" class="space-y-3">
                        <!-- Dynamic ingredient rows here -->
                    </div>
                    <button type="button" id="btn-add-slurry-ingredient" class="btn btn-secondary mt-3">+ Add Ingredient</button>
                </fieldset>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="btn-cancel-slurry" class="btn btn-outline">Cancel</button>
                    <button type="submit" id="btn-save-slurry" class="btn btn-primary">Save Slurry Batch</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: New Shito Batch -->
    <div id="modal-shito-batch" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div id="modal-shito-batch-backdrop" class="fixed inset-0"></div>
        <div class="relative top-10 mx-auto p-6 border w-full max-w-3xl shadow-lg rounded-xl bg-white z-10">
            <h3 class="text-2xl font-semibold text-orange-600">New Shito Batch Entry (Pre-Cook)</h3>
            <form id="form-shito-batch" class="mt-4 space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Date</label>
                        <input type="date" name="date" class="form-input" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Shift</label>
                        <select name="shift" class="form-input" required>
                            <option value="">Select Shift</option>
                            <option value="SHa">SHa (Morning)</option>
                            <option value="SHb">SHb (Afternoon)</option>
                            <option value="SHc">SHc (Night)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Batch #</label>
                        <input type="text" name="batchNumber" class="form-input" placeholder="e.g., B1" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Variant</label>
                        <select name="variant" class="form-input" required>
                            <option value="">Select Variant</option>
                            <option value="HOT">HOT</option>
                            <option value="MILD">MILD</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">SKU</label>
                        <select name="sku" class="form-input" required>
                            <option value="">Select SKU</option>
                            <option value="30g sachet">30g sachet</option>
                            <option value="200g Jar">200g Jar</option>
                            <option value="450g Jar">450g Jar</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Batch Size (T)</label>
                        <input type="number" step="0.01" name="batchSize" class="form-input" placeholder="e.g., 1.5">
                    </div>
                </div>
                <fieldset class="border border-orange-200 p-4 rounded-lg">
                    <legend class="text-lg font-medium text-orange-600 px-2">Ingredients</legend>
                    <div id="shito-batch-ingredients-list" class="space-y-3">
                        <!-- Dynamic ingredient rows here -->
                    </div>
                    <button type="button" id="btn-add-shito-ingredient" class="btn btn-secondary mt-3">+ Add Ingredient</button>
                </fieldset>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="btn-cancel-shito-batch" class="btn btn-outline">Cancel</button>
                    <button type="submit" id="btn-save-shito-batch" class="btn btn-primary">Save Shito Batch</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: New Shito Cooking Log -->
    <div id="modal-shito-cooking" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div id="modal-shito-cooking-backdrop" class="fixed inset-0"></div>
        <div class="relative top-10 mx-auto p-6 border w-full max-w-4xl shadow-lg rounded-xl bg-white z-10">
            <h3 class="text-2xl font-semibold text-orange-600">New Shito Cooking Log</h3>
            <form id="form-shito-cooking" class="mt-4 space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Date</label>
                        <input type="date" name="date" class="form-input" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Shift</label>
                        <select name="shift" class="form-input" required>
                            <option value="">Select Shift</option>
                            <option value="SHa">SHa (Morning)</option>
                            <option value="SHb">SHb (Afternoon)</option>
                            <option value="SHc">SHc (Night)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Batch ID</label>
                        <input type="text" name="batchId" class="form-input" placeholder="e.g., B1-C1" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Variant</label>
                        <select name="variant" class="form-input" required>
                            <option value="">Select Variant</option>
                            <option value="HOT">HOT</option>
                            <option value="MILD">MILD</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">SKU</label>
                        <select name="sku" class="form-input" required>
                            <option value="">Select SKU</option>
                            <option value="30g sachet">30g sachet</option>
                            <option value="200g Jar">200g Jar</option>
                            <option value="450g Jar">450g Jar</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Cooking Cycle</label>
                        <input type="text" name="cookingCycle" class="form-input" placeholder="e.g., Cycle 1" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Boule ID</label>
                        <input type="text" name="bouleId" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">GOG Start Time</label>
                        <input type="time" name="gogStart" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">GOG End Time</label>
                        <input type="time" name="gogEnd" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Batch Size (T)</label>
                        <input type="number" step="0.01" name="batchSize" class="form-input" placeholder="e.g., 1.5">
                    </div>
                </div>
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Cooking Start Time</label>
                        <input type="time" name="cookStart" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Cooking End Time</label>
                        <input type="time" name="cookEnd" class="form-input">
                    </div>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Initial pH</label>
                        <input type="number" step="0.01" name="phInitial" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Final pH</label>
                        <input type="number" step="0.01" name="phFinal" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Initial Moisture</label>
                        <input type="number" step="0.01" name="moistureInitial" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Initial Temp</label>
                        <input type="number" step="0.01" name="tempInitial" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Initial Pressure</label>
                        <input type="number" step="0.01" name="pressureInitial" class="form-input">
                    </div>
                </div>
                <fieldset class="border border-orange-200 p-4 rounded-lg">
                    <legend class="text-lg font-medium text-orange-600 px-2">Hourly Cooking Records</legend>
                    <div id="hourly-records-list" class="space-y-3">
                        <!-- Dynamic hourly records here -->
                    </div>
                    <button type="button" id="btn-add-hourly-record" class="btn btn-secondary mt-3">+ Add Hourly Record</button>
                </fieldset>
                <div>
                    <label class="block text-sm font-medium mb-1">Comments</label>
                    <textarea name="comments" rows="3" class="form-input"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="btn-cancel-shito-cooking" class="btn btn-outline">Cancel</button>
                    <button type="submit" id="btn-save-shito-cooking" class="btn btn-primary">Save Cooking Log</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: View Log Details -->
    <div id="modal-view-log" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div id="modal-view-log-backdrop" class="fixed inset-0"></div>
        <div class="relative top-10 mx-auto p-6 border w-full max-w-3xl shadow-lg rounded-xl bg-white z-10">
            <h3 id="view-log-title" class="text-2xl font-semibold text-orange-600 mb-4">Log Details</h3>
            <div id="view-log-content" class="space-y-4">
                <!-- Content injected by JS -->
            </div>
            <div class="flex justify-end space-x-3 pt-6">
                <button type="button" id="btn-delete-log" class="btn btn-danger">Delete Log</button>
                <button type="button" id="btn-close-view-log" class="btn btn-outline">Close</button>
                <button type="button" id="btn-export-pdf" class="btn btn-primary">Export as PDF</button>
            </div>
        </div>
    </div>

    <!-- Custom Alert Box -->
    <div id="custom-alert" class="hidden">
        <div class="alert-box">
            <h4 id="alert-title" class="text-xl font-semibold mb-2">Alert</h4>
            <p id="alert-message" class="text-gray-700 mb-6">This is an alert message.</p>
            <button id="alert-ok-btn" class="btn btn-primary w-full">OK</button>
        </div>
    </div>


    <!-- Firebase App (v11.6.1) -->
    <script type="module">
        // Import Firebase services
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, collection, addDoc, getDocs, onSnapshot, 
            query, orderBy, doc, getDoc, deleteDoc, setDoc, serverTimestamp, setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==========================================================
        // --- 1. YOUR FIREBASE CONFIG ---
        // ==========================================================
        const firebaseConfig = {
          apiKey: "AIzaSyB2jsnwvaQIJvUPLIvdWx7yS4o0xU0QOis",
          authDomain: "production-log-16c82.firebaseapp.com",
          projectId: "production-log-16c82",
          storageBucket: "production-log-16c82.appspot.com",
          messagingSenderId: "751331602949",
          appId: "1:751331602949:web:86843596e32483865aa26c",
          measurementId: "G-29Q2HK3SG4"
        };
        // ==========================================================
        
        // --- 2. YOUR GOOGLE APPS SCRIPT URL ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyLWIV5qR7e8JYiIfHdQioywXO_csSfjamvy7nvJr1nkf9x53IWHSMuziKBSu3iynSLnw/exec";
        // ==========================================================

        // Global variables
        let app, auth, db;
        let savedSlurryLogs = [];
        let savedShitoBatchLogs = [];
        let savedShitoCookingLogs = [];
        let slurryChart, shitoChart;
        const { jsPDF } = window.jspdf;

        // =================================================================
        // --- GLOBAL UI FUNCTIONS (Navigation, Modals, etc.) ---
        // =================================================================

        /**
         * Shows the specified page and hides all others.
         * This is the navigation logic from winner.txt.
         */
        const showPage = (pageId) => {
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            const page = document.getElementById(pageId);
            if (page) {
                page.style.display = 'block';
            } else {
                console.error("Page not found:", pageId);
                document.getElementById('page-home').style.display = 'block'; // Fallback
            }
            
            // Special case for summary page
            if (pageId === 'page-summary') {
                initSummaryCharts();
            }
        }

        const openModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
            }
            // Clear and pre-fill forms
            if (modalId === 'modal-slurry') {
                const list = document.getElementById('slurry-ingredients-list');
                list.innerHTML = ''; // Clear
                addSlurryIngredient("36-38% Bulk paste");
                addSlurryIngredient("Starch");
                addSlurryIngredient("Fibre");
                addSlurryIngredient("Salt");
                addSlurryIngredient("Water");
            } else if (modalId === 'modal-shito-batch') {
                const list = document.getElementById('shito-batch-ingredients-list');
                list.innerHTML = ''; // Clear
                addShitoBatchIngredient("Peeled ginger");
                addShitoBatchIngredient("Peeled onion");
                addShitoBatchIngredient("Peeled garlic");
                addShitoBatchIngredient("Tomato paste");
                addShitoBatchIngredient("Pepper");
                addShitoBatchIngredient("Nutmeg");
                addShitoBatchIngredient("Shrimp powder");
                addShitoBatchIngredient("Rosemary");
            } else if (modalId === 'modal-shito-cooking') {
                const list = document.getElementById('hourly-records-list');
                list.innerHTML = ''; // Clear
                addHourlyRecord();
            }
        }

        const closeModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        const showAlert = (title, message) => {
            document.getElementById('alert-title').textContent = title;
            document.getElementById('alert-message').textContent = message;
            document.getElementById('custom-alert').classList.add('show');
        }

        const addSlurryIngredient = (presetName = "") => {
            const list = document.getElementById('slurry-ingredients-list');
            const index = list.children.length;
            const row = document.createElement('div');
            row.className = 'grid grid-cols-5 gap-2
